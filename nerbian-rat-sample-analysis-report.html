<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yauv.me","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="本篇文章为本人原创，首发于freebuf 前言Proofpoint的安全研究员发现并分析了这个新型恶意软件并命名为NerbianRAT，此恶意软件使用了反分析和反逆向功能，该恶意软件是使用Golang编写的64位程序，主要传播方式为冒充世界卫生组织发送的COVID-19相关的安全措施邮件，通过邮件附件中有VBA宏的Word文档传播。">
<meta property="og:type" content="article">
<meta property="og:title" content="NerbianRat样本分析报告">
<meta property="og:url" content="https://yauv.me/nerbian-rat-sample-analysis-report.html">
<meta property="og:site_name" content="yauv&#39;s blog">
<meta property="og:description" content="本篇文章为本人原创，首发于freebuf 前言Proofpoint的安全研究员发现并分析了这个新型恶意软件并命名为NerbianRAT，此恶意软件使用了反分析和反逆向功能，该恶意软件是使用Golang编写的64位程序，主要传播方式为冒充世界卫生组织发送的COVID-19相关的安全措施邮件，通过邮件附件中有VBA宏的Word文档传播。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/lrQXGo15CwxqYBDoSiNrBU9U5qEHGpR8/1.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FjUczrL9VpMCiDj2Yt0zSsBGSWzcSSL0/2.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/rMwIg6PQVu1wGNqrnc1ALAPXpOs3x4Hg/3.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/fAtMHjQAFE2pF3NjvRpCtTclmtGyEaq3/4.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/cxk0Hof3zol4plqhUFTLtAmbeOiYWM34/5.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/1pDqypmkR9lxvT0QxfJrfhOGFDkp8sMz/6.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/xW7IuAPbP6bNTDnRtskWqq1p07dyNP7k/7.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/3XGcshT1wqwvhSXkgXW0p79CUBpdAoW0/8.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/p6cO4FxDjdp7fNpx9Q5xGQuM8WV8weFM/9.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/DYz7H4k4a7AgtWBlmGregNvWkFrbLwvH/10.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/nrzzGQPN32KD3IG4l0diwk6O3o1XbArw/11.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/2zT7YbFnhuqEFp4XgNfrS7CRH4uRMj6A/12.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/RsWzhYxTJQ9nKHeK8nBcuLdzG64IGz1m/13.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/PTwrV4T8h2lEeNhoKV5AfU32tTHR00FD/14.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/1K1UWWEuI2ILAuBnF80g5RBB2BCHWcHY/15.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/vxDfCes9FO8tpMEGrfYXKwCQX6r4ANyH/16.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/aRhUOSxfMRdwuH2iEcRnJeBAyrHCHeFd/17.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/5ft13GjlwJGWeMBK8Eht4w5D4kmebwBF/18.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/LUrp0PgPDFUL3YP2D0sunmpyJCbGoIxS/19.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FN3DFqAn2EfW32LtQ2iyUiYHMH7XYbmW/20.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/OzTYDyyDVWBbQkjO9vOdpze5CrxECvUB/21.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/6jVCJ0TDAVPYkPqmDkKiKVq3v9eA0Vx5/22.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/dENTPJka8beaCCN51A9McRPhlCtVxy9y/23.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/iFR6pv6NEMnRx9X3lzPpO1XEVqQO2Dzw/24.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/XNhU1fqJlXonzpzkeensU6A8Vwecjgf6/25.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/SKE7FWUtBehBJemSFBob8bg5NojbB19L/26.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/LuimWLN5iypFfKvKItKVLHBLW6K7flT5/27.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/x0Qo1t0EqbGArjVRHwdQoFGUEgoULmsJ/28.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FhCnTxquWIqyOtewSz8usesBBtm3EDIj/29.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Gy0bVBJVvs5SuumHUm6PGJEMHrfO6ufG/30.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/EqcdG0AbLYwMYYcIMBw7rSLdmEdW2dFc/31.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/tTXBOrQWKJib1mssD8bYfPhJfIF4vRxz/32.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/LRR4IKs1aOykHaLUGBdH7CuWbV4JuecP/33.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/V7ajMpnkT1VYsADTuokkedkjrwpcwH6Q/34.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/bustnmFFi6jhCx134VvXVpz6PbN0gtFl/35.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/kejHXvtTlVK3IU2fbPIcFnNyICq6crIk/36.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/QAl9H2AMRkuXqm2EYJ3bNR3GvD0XLoUQ/37.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FGPFkFgiF6YUKQp8jigDtwHKOSqGvFcF/38.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/vb8ilzjmfFHUTcxTK7yjlbxbahF1qSOP/39.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/K3ktGM8PYJTEpqNDUxGYk113aPr0iCGQ/40.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FhSoWNFx27LVpAhVhVRkEhqBLGnGiUpk/41.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/NIyU91w0bQlb4opzojVpSycuyuWQPKJm/42.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Kx5rDmOWtV3fAFysNtWEHfJJSBJgCR4R/43.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/uy9omQOeUcuhwIuvWzq5wIi5nouKgHFz/44.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Ku5uafFnkTj77otlJLrBNCr3IX09W8Vf/45.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/VEwokY5CWgs409SBA3kRPKW26pCiXfDB/46.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/vaqvi4upJRhbYQXpGCDSSnMQvthbVnS1/47.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/pn8VnjHsWzrqgBKLNO5Bt193lDYOcQzU/48.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/8FSUge0TuqFSUNvJCRMKfDepYnmk5Wpi/49.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/YvX2j6REEEnUP94l4lRnblbkh1njUQCg/50.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Ch3g8lV2kRtqkgN6IPPLvLngYtUkMVOB/51.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/ouo0j6kME3OgybnljJ7pyMQmGqCtFaew/52.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/0sdXee06F2yN9KuHgfAp8GA8dt4DyM4n/53.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Gmn47sfUIvVFBelDlKxYS6lABVcPThLT/54.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/EaaFNgwdBrF67ythjENEeVCs80sOpi1S/55.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/B7fVDS9KKGwRAfJv5bNJgbMIBaoFtGkG/56.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/dms9nLD9gXw57f5fqWRSOy4P5SMFdzW5/57.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/SzFhyUbtCl4cMsypeydsOfrtYTubdWg0/58.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/xY7nFSLOt7RNxMLOseXryDgaDIps0xIa/59.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/jswllTqafHqYfyKYrJ9UdA4BG2RNX9an/60.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/sYhg2l64bYeAkn7IsPtdfU6L6iMeo5IY/61.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Yx0xrCoqsNhUYAPNzrcM9SuEMPuQOi91/62.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/46oqgDFDT7XtKlDJUA8yUPhASITv2ne8/63.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/BuWxmUXmmIS9bX8H9RwWXK33LOoHABDU/64.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/BH5IjkQhSda7b1nvzMTLgra7qK570Dd1/65.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/LdorcwPOhPPk8rUXunUxM0rQ2Hpeqr8M/66.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/sBRSWryMQRj714EcfBdkBtXFbDMOE0IT/67.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/L4pqILIpGdcz5lhvUNWocEyfWiWhB5Cy/68.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/2AEyxmu1Ub2CLQgoenGAPQksMqw47VtD/69.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/q4WA95sm4JvLP42aFG7nFUHTReB7S0aH/93.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/cC7XX0Fzhi4ESMvLwJTzB7YtTy8n4kKb/70.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/BRrrbgOO5rd46neu3enzXWLn4st3l5Dp/94.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/SSO37MAeQRstOMkx8HaJEvOSdqiJqmKb/71.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/gDrrSbObyDGalkQMYoHKVmmd8CxnHqhf/72.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/GfUojlusOMyhkMDxOAvzXge15wPeEnLp/73.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/IpS7gyz1W3m2wqqPluXDMSb8mu5Vcp2l/74.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/OBwtse1XCFucVJnVbBgw63SuNeyFOkMg/75.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/cd43O6cIIsBrPUN6GzERczbD0g7UtfUa/76.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/KAKocQJ2BXMY1N3aXK5dmmYiCJ6OLbMJ/77.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/9WeEqU9RReY90XHhjxq5nnMQBSTkRBLJ/78.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/hmBz1DxTdSh8YMBy9bhJ1Ol4brXBBHcB/79.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/6XhKYEVUr1tCsoGMaiRUeHwNCTj4LvjI/80.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/n2DWJm1OIMQ8HlGmmx2WUoc4IGP9lqG6/81.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/qcQlQE6mGGBEzjh5YhLxH9K6KrmJJGat/82.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/5hpQdxPxl8n6cEiGwfu8omTaxfsMOxTS/83.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/C02zFUffO95zgrbcm37svo5nBHUiFTK0/84.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/DeVnFvU8hCIJFfILV3acJ4d3LlUmpEVW/85.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/3Eprv3xAFjfEkmwdpU1RaPSeDxsch7Ik/86.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/sXXjNLeLLBGiDnXaGmXCzLal9kKAbiOj/87.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/GzLnquP58soXSWVkIsacqD4a73mwwnSj/88.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/jqLvmyJYAR9YNhGQaKnD4Yt7YbzYBCOU/89.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/29QUQpKqYGC4euulTBgGXMqa58JAWe8H/90.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/ksVfAeoa10C8IF779JO4Adzw3y9WTYl2/91.jpg">
<meta property="og:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/yETTA2Hj33Qej4V4pjrYuC296il4UoxA/92.jpg">
<meta property="article:published_time" content="2022-07-14T05:42:01.000Z">
<meta property="article:modified_time" content="2022-09-28T07:39:21.966Z">
<meta property="article:author" content="yauv">
<meta property="article:tag" content="NerbianRat">
<meta property="article:tag" content="golang">
<meta property="article:tag" content="逆向工程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/lrQXGo15CwxqYBDoSiNrBU9U5qEHGpR8/1.jpg">


<link rel="canonical" href="https://yauv.me/nerbian-rat-sample-analysis-report.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://yauv.me/nerbian-rat-sample-analysis-report.html","path":"nerbian-rat-sample-analysis-report.html","title":"NerbianRat样本分析报告"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>NerbianRat样本分析报告 | yauv's blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="yauv's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">yauv's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%B7%E6%9C%AC%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">样本运行流程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%B7%E6%9C%ACIOCs"><span class="nav-number">3.</span> <span class="nav-text">样本IOCs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">恶意代码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#doc%E5%AE%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">4.1.</span> <span class="nav-text">doc宏代码分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UpdateUAV-exe%E5%88%86%E6%9E%90"><span class="nav-number">4.2.</span> <span class="nav-text">UpdateUAV.exe分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MoUsoCore-exe%E5%88%86%E6%9E%90"><span class="nav-number">4.3.</span> <span class="nav-text">MoUsoCore.exe分析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yauv</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yauv" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yauv" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yauv.me/nerbian-rat-sample-analysis-report.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yauv">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yauv's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="NerbianRat样本分析报告 | yauv's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          NerbianRat样本分析报告
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-14 13:42:01" itemprop="dateCreated datePublished" datetime="2022-07-14T13:42:01+08:00">2022-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">样本分析</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><strong>本篇文章为本人原创，首发于<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/338610.html">freebuf</a></strong></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Proofpoint的安全研究员发现并分析了这个新型恶意软件并命名为NerbianRAT，此恶意软件使用了反分析和反逆向功能，该恶意软件是使用Golang编写的64位程序，主要传播方式为冒充世界卫生组织发送的COVID-19相关的安全措施邮件，通过邮件附件中有VBA宏的Word文档传播。</p>
<span id="more"></span>

<h1 id="样本运行流程"><a href="#样本运行流程" class="headerlink" title="样本运行流程"></a>样本运行流程</h1><p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/lrQXGo15CwxqYBDoSiNrBU9U5qEHGpR8/1.jpg"></p>
<h1 id="样本IOCs"><a href="#样本IOCs" class="headerlink" title="样本IOCs"></a>样本IOCs</h1><p>名称: ee1bbd856bf72a79221baa0f7e97aafb6051129905d62d74a37ae7754fccc3db.doc<br>大小: 280469 字节 (273 KiB)<br>MD5: d7888fea6047b662a30bf00edac4c3ee<br>SHA1: 8137670512be55796f612e41602f505955b0bb0c<br>SHA256: ee1bbd856bf72a79221baa0f7e97aafb6051129905d62d74a37ae7754fccc3db</p>
<p>名称: MoUsoCore.exe<br>大小: 5867008 字节 (5729 KiB)<br>MD5: 5d5bc970f975341558b8d2c225ca0115<br>SHA1: 4f74826ed56cda233cfc12b86fd1b7da4a9f2e56<br>SHA256: 902c65435b6b44cfda1156b0e7c6a30b2785fa4f2cbb9b1944a66f5146ec7aa5</p>
<p>名称: UpdateUAV.exe<br>大小: 3642880 字节 (3557 KiB)<br>MD5: 9cca59eec5af63e42cd845b67cf6df89<br>SHA1: 178aad6c7918cc495a908944e79143a913630890<br>SHA256: 1b8c9e7c150bacd466fbe7f12b39883821f23b67cae0a427a57dc37e5ea4390f</p>
<h1 id="恶意代码分析"><a href="#恶意代码分析" class="headerlink" title="恶意代码分析"></a>恶意代码分析</h1><h2 id="doc宏代码分析"><a href="#doc宏代码分析" class="headerlink" title="doc宏代码分析"></a>doc宏代码分析</h2><p>双击打开doc文件发现是一个带宏的文档，文档中诱导用户点击启用宏脚本</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FjUczrL9VpMCiDj2Yt0zSsBGSWzcSSL0/2.jpg"></p>
<p>这里我使用olevba脚本来分析此word文档的vba代码</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/rMwIg6PQVu1wGNqrnc1ALAPXpOs3x4Hg/3.jpg"></p>
<p>olevba脚本已经帮我们分析出了此vba代码的主要功能，从解码的Base64字符串我们大致可以判断此vba脚本使用powershell从C2下载了payload并写入本地文件夹执行</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/fAtMHjQAFE2pF3NjvRpCtTclmtGyEaq3/4.jpg"></p>
<p>此vba代码有三个函数，GetByte和DecodeBase64这两个函数功能为解码Base64</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/cxk0Hof3zol4plqhUFTLtAmbeOiYWM34/5.jpg"></p>
<p>主要的Document_Open入口函数我们可以看到定义了很多字符串但都是经过Base64编码，这些字符串在使用之前都调用DecodeBase64函数进行解码</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/1pDqypmkR9lxvT0QxfJrfhOGFDkp8sMz/6.jpg"></p>
<p>我们将Base64字符串解码后优化代码再查看逻辑更清晰，主要逻辑就是红框中的命令行，使用cmd.exe将powershell命令行写入%temp%\util.bat，然后执行bat脚本，从<code>hxxps://www[.]fernandestechnical[.]com/pub/media/gitlog</code>下载文件到%appdata%\UpdateUAV.exe并且执行，执行完UpdateUAV.exe后将%temp%\util.bat和%appdata%\UpdateUAV.exe删除</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/xW7IuAPbP6bNTDnRtskWqq1p07dyNP7k/7.jpg"></p>
<h2 id="UpdateUAV-exe分析"><a href="#UpdateUAV-exe分析" class="headerlink" title="UpdateUAV.exe分析"></a>UpdateUAV.exe分析</h2><p>我们查看从C2下载的dropper文件，通过详细信息可以看到，文件详细信息伪装成Windows系统程序，这里还可以发现此dropper的原始文件是nsoobe.exe</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/3XGcshT1wqwvhSXkgXW0p79CUBpdAoW0/8.jpg"></p>
<p>使用DIE工具查看UpdateUAV.exe发现此程序是64位程序并且使用了UPX3.9.6压缩壳进行加壳</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/p6cO4FxDjdp7fNpx9Q5xGQuM8WV8weFM/9.jpg"></p>
<p>我这里使用了UPX -d命令直接进行自动脱壳，如果遇到了修改版的UPX就需要手动脱壳，脱完壳文件体积膨胀到了将近一倍</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/DYz7H4k4a7AgtWBlmGregNvWkFrbLwvH/10.jpg"></p>
<p>脱完壳我们在使用DIE工具查看此UpdateUAV.exe是使用Golang编写的，Go编译器版本号为1.15.0或以上的版本</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/nrzzGQPN32KD3IG4l0diwk6O3o1XbArw/11.jpg"></p>
<p>要想确定精确的Go编译器版本可以通过搜索字符串<code>go1.</code>关键词，可以看到UpdateUAV.exe使用的是go1.17.3版本编译器，注意此方法在遇到去除符号信息和严重混淆的样本可能无效</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/2zT7YbFnhuqEFp4XgNfrS7CRH4uRMj6A/12.jpg"></p>
<p>这里直接使用IDA打开文件进行分析，查看main函数发现此Golang程序的符号信息都在，代码并没有被加密或者混淆，我们甚至可以通过函数符号名分析出函数的大致功能，比如函数main_hideWindows可以推断是隐藏进程窗口</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/RsWzhYxTJQ9nKHeK8nBcuLdzG64IGz1m/13.jpg"></p>
<p>我们使用x64dbg进行动态调试，这里为了方便调试我们手动关闭掉随机基址，使用010Editor打开PE文件将Nt头中的扩展头中的DllCharacteristics前1个字节改为00就关闭了PE文件的随机基址，这里原始是字节60 81</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/PTwrV4T8h2lEeNhoKV5AfU32tTHR00FD/14.jpg"></p>
<p>我们改为00 81并保存至此已经成功将随机基址关闭</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/1K1UWWEuI2ILAuBnF80g5RBB2BCHWcHY/15.jpg"></p>
<p>我们此时再把IDA中的符号信息导出成MAP文件并导入x64dbg，打开IDA选择File-&gt;Produce file-&gt;Create MAP file然后选择保存位置，把全部选框都勾上确认</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/vxDfCes9FO8tpMEGrfYXKwCQX6r4ANyH/16.jpg"></p>
<p>然后使用x64dbg的SwissArmyKnife插件导入MAP文件</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/aRhUOSxfMRdwuH2iEcRnJeBAyrHCHeFd/17.jpg"></p>
<p>当x64dbg导入MAP文件后通过查看IDA中的main函数地址并下断点，MAP文件导入x64dbg后让我们可以和IDA分析更好的同步</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/5ft13GjlwJGWeMBK8Eht4w5D4kmebwBF/18.jpg"></p>
<p>首先分析hideWindows函数，通过函数名可猜测此函数是隐藏控制台窗口，首先使用GetConsoleWindow获取控制台窗口句柄</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/LUrp0PgPDFUL3YP2D0sunmpyJCbGoIxS/19.jpg"></p>
<p>最后调用ShowWindowAsync函数使用SW_HIDE参数将控制台窗口隐藏</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FN3DFqAn2EfW32LtQ2iyUiYHMH7XYbmW/20.jpg"></p>
<p>接下来分析checkEnvironment函数，可以看到此函数中调用了github上的第三方包chacal</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/OzTYDyyDVWBbQkjO9vOdpze5CrxECvUB/21.jpg"></p>
<p>我们搜索发现chacal这个包是Golang的反虚拟机框架</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/6jVCJ0TDAVPYkPqmDkKiKVq3v9eA0Vx5/22.jpg"></p>
<p>checkEnvironment函数主要通过5个函数实现，其中两个函数都是安全工具进程检测，另外三个函数主要是反虚拟机检测</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/dENTPJka8beaCCN51A9McRPhlCtVxy9y/23.jpg"></p>
<p>antidebug_processList函数调中又调用了第三方的包go_ps实现遍历windows进程</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/iFR6pv6NEMnRx9X3lzPpO1XEVqQO2Dzw/24.jpg"></p>
<p>使用了CreateToolhelp32Snapshot函数创建进程快照，然后使用Process32First和Process32Next函数组合遍历进程</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/XNhU1fqJlXonzpzkeensU6A8Vwecjgf6/25.jpg"></p>
<p>Process32Next遍历下一个进程</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/SKE7FWUtBehBJemSFBob8bg5NojbB19L/26.jpg"></p>
<p>遍历完进程后将调用github_com_p3tr0v_chacal_utils_PList函数进行对比</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/LuimWLN5iypFfKvKItKVLHBLW6K7flT5/27.jpg"></p>
<p>先对比进程黑名单列表字符串长度，如果长度相同则调用runtime_memequal函数进行字符串对比</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/x0Qo1t0EqbGArjVRHwdQoFGUEgoULmsJ/28.jpg"></p>
<p>进程黑名单列表一共有42个如下，antimem_processList函数和antidebug_processList函数逻辑都相同不过antimem_processList只检测了DumpIt.exe、RAMMap.exe、RAMMap64.exe、vmmap.exe这四个用于DUMP进程内存的工具进程所以就不贴图了</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FhCnTxquWIqyOtewSz8usesBBtm3EDIj/29.jpg"></p>
<p>IsVirtualDisk函数首先调用了queryWMI函数，此函数封装了两个函数先调用了CreateQuery函数创建了WMI WQL查询语句</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Gy0bVBJVvs5SuumHUm6PGJEMHrfO6ufG/30.jpg"></p>
<p>然后调用wmi_Query函数使用WMI WQL语句进行查询了网卡信息</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/EqcdG0AbLYwMYYcIMBw7rSLdmEdW2dFc/31.jpg"></p>
<p>最后调用了ContainsInList函数对比网卡是否为列表中名单中的虚拟网卡，虚拟网卡黑名单列表中有三个virtual,vmware, vbox</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/tTXBOrQWKJib1mssD8bYfPhJfIF4vRxz/32.jpg"></p>
<p>接下来分析ByMacAddress函数该函数首先调用了getMacAddr函数查询本机的MAC地址</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/LRR4IKs1aOykHaLUGBdH7CuWbV4JuecP/33.jpg"></p>
<p>然后调用ContainsPrefix函数对比本机和黑名单列表的的MAC地址</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/V7ajMpnkT1VYsADTuokkedkjrwpcwH6Q/34.jpg"></p>
<p>接下来分析diskTotalSize函数，从函数符号可猜测此函数用来检测硬盘大小，通过函数的传参0x64十进制为100可以猜测此检测大小为100GB</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/bustnmFFi6jhCx134VvXVpz6PbN0gtFl/35.jpg"></p>
<p>通过分析diskTotalSize函数内部，也是调用了queryWMI函数进行查询硬盘信息，然后对比本机硬盘是否小于100GB，我的虚拟机硬盘大小为99GB十六进制0x63</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/kejHXvtTlVK3IU2fbPIcFnNyICq6crIk/36.jpg"></p>
<p>如果以上反调试检测都通过，接着使用IsDebuggerPresent检测本进程是否被调试，还调用了time_Since函数和函数开头的time_Now组合检测函数运行时间判断进程是否被调试</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/QAl9H2AMRkuXqm2EYJ3bNR3GvD0XLoUQ/37.jpg"></p>
<p>checkLocation函数使用GET请求<code>hxxps://json[.]geoiplookup[.]io</code>网站获取json格式的公网IP归属地，但是此网站屏蔽了ASN为4134的IP地址所以此处返回值为错误代码</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FGPFkFgiF6YUKQp8jigDtwHKOSqGvFcF/38.jpg"></p>
<p>正常如果获取到了本机IP归属地会和列表中的地区进行比较，我们可以看到此列表中，只有两个具体的地区伦敦和俄罗斯在这两个中间的单词都为一些少儿不宜的话</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/vb8ilzjmfFHUTcxTK7yjlbxbahF1qSOP/39.jpg"></p>
<p>一共对比了列表中7个单词，从2到6个单词可以猜测此恶意软件的作者可能是个种族歧视主义者</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/K3ktGM8PYJTEpqNDUxGYk113aPr0iCGQ/40.jpg"></p>
<p>调用strings_Index函数进行逐一对比</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/FhSoWNFx27LVpAhVhVRkEhqBLGnGiUpk/41.jpg"></p>
<p>checkLocation函数检测如果IP归属地不在列表中则会调用downloadNerbian函数从C2服务器下载NerbianRAT主体程序</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/NIyU91w0bQlb4opzojVpSycuyuWQPKJm/42.jpg"></p>
<p>分析downloadNerbian函数，此函数首先会使用RedFile函数打开<code>C:\\ProgramData\\USOShared\\MoUsoCore.exe</code>路径中的文件</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Kx5rDmOWtV3fAFysNtWEHfJJSBJgCR4R/43.jpg"></p>
<p>如果文件不存在则会从C2下载，如果存在此文件还会判断此文件前两个字节是否为4D5A（MZSignature）用于判断此文件是否为PE文件</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/uy9omQOeUcuhwIuvWzq5wIi5nouKgHFz/44.jpg"></p>
<p>调用downloadFile函数从C2下载NerbianRAT</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Ku5uafFnkTj77otlJLrBNCr3IX09W8Vf/45.jpg"></p>
<p>如果首次从C2下载失败，还会调用cmd使用curl从C2下载</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/VEwokY5CWgs409SBA3kRPKW26pCiXfDB/46.jpg"></p>
<p>从C2下载完成后都会读取文件并检测文件头两个字节是否为4D5A（MZSignature）判断是否为PE文件</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/vaqvi4upJRhbYQXpGCDSSnMQvthbVnS1/47.jpg"></p>
<p>最后一个函数是创建计划任务实现持久化运行，首先通过CMD调用格式化好的命令创建计划任务</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/pn8VnjHsWzrqgBKLNO5Bt193lDYOcQzU/48.jpg"></p>
<p>我们可以打开计划任务查看，可以看到触发条件是每隔1小时运行一次</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/8FSUge0TuqFSUNvJCRMKfDepYnmk5Wpi/49.jpg"></p>
<p>触发操作就是启动从C2下载的NerbianRAT</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/YvX2j6REEEnUP94l4lRnblbkh1njUQCg/50.jpg"></p>
<p>如果创建计划任务成功则直接触发执行运行NerbianRAT，至此UpdateUAV.exe这个dropper程序就分析完成</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Ch3g8lV2kRtqkgN6IPPLvLngYtUkMVOB/51.jpg"></p>
<h2 id="MoUsoCore-exe分析"><a href="#MoUsoCore-exe分析" class="headerlink" title="MoUsoCore.exe分析"></a>MoUsoCore.exe分析</h2><p>接下来我们分析NerbianRAT主体程序，NerbianRAT一样使用了UPX压缩壳还是一样的流程脱壳，此样本去除大部分的符号信息，不过我们还是可以通过搜索<code>github</code>关键词查找MoUsoCore.exe的函数可以查看使用的go开源包，通过如下这些包可以大致判断出NerbianRAT的大致功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">smbios包提供对系统管理BIOS(SMBIOS)和桌面管理接口(DMI)数据和结构的检测和访问：github[.]com/digitalocean/go-smbios</span><br><span class="line">Windows WMI提供了WQL接口：github[.]com/StackExchange/wmi</span><br><span class="line">桌面截图：github[.]com/kbinani/screenshot</span><br><span class="line">go的WindowsAPI封装：github[.]com/AllenDang/w32</span><br><span class="line">golang的win32 ole实现：github[.]com/go-ole/go-ole</span><br><span class="line">go的WindowsAPI封装：github[.]com/lxn/win</span><br></pre></td></tr></table></figure>

<p>golang有一种特殊的函数初始化函数，定义格式<code>fcun init()</code>，此函数会在main函数之前执行，并且同一个包可以定义多个init函数，编译时编译器会自动更名，这里可以看到main包中一共有两个init初始化函数</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/ouo0j6kME3OgybnljJ7pyMQmGqCtFaew/52.jpg"></p>
<p>其中的main_init_0使用了硬编码的AesGCM加密模式的密钥解密了很多需要使用到的字符串</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/0sdXee06F2yN9KuHgfAp8GA8dt4DyM4n/53.jpg"></p>
<p>调用gcmAsm_open解密</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Gmn47sfUIvVFBelDlKxYS6lABVcPThLT/54.jpg"></p>
<p>可以看到解密出来的是一个ip地址此地址应该是和C2相关的，接下来还进行了多次解密出剩下的加密字符串</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/EaaFNgwdBrF67ythjENEeVCs80sOpi1S/55.jpg"></p>
<p>下面开始分析main函数，第一个函数调用main_I4JkbFMH还是个进程检测名单</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/B7fVDS9KKGwRAfJv5bNJgbMIBaoFtGkG/56.jpg"></p>
<p>使用了github开源的StackExchange包通过WQL语句<code>SELECT * FROM Win32_Process</code>查询了本机进程</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/dms9nLD9gXw57f5fqWRSOy4P5SMFdzW5/57.jpg"></p>
<p>对比进程黑名单列表</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/SzFhyUbtCl4cMsypeydsOfrtYTubdWg0/58.jpg"></p>
<p>接下来分析main_H5NzwUxN函数，首先获取了本机BIOS信息，然后对获取到的BIOS信息使用MD5算法进行了哈希</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/xY7nFSLOt7RNxMLOseXryDgaDIps0xIa/59.jpg"></p>
<p>然后将MD5值类型转换成16进制</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/jswllTqafHqYfyKYrJ9UdA4BG2RNX9an/60.jpg"></p>
<p>接着使用getCurrentProcessId函数获取了本进程的PID并同样对PID使用MD5进行哈希</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/sYhg2l64bYeAkn7IsPtdfU6L6iMeo5IY/61.jpg"></p>
<p>同样的将MD5值类型转换为16进制</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/Yx0xrCoqsNhUYAPNzrcM9SuEMPuQOi91/62.jpg"></p>
<p>接着生成了一个唯一ID</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/46oqgDFDT7XtKlDJUA8yUPhASITv2ne8/63.jpg"></p>
<p>接着将生成的唯一ID转为大写字母</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/BuWxmUXmmIS9bX8H9RwWXK33LOoHABDU/64.jpg"></p>
<p>函数main_H5NzwUxN获取收集了主机名称等信息</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/BH5IjkQhSda7b1nvzMTLgra7qK570Dd1/65.jpg"></p>
<p>函数main_JgJWgOp中调用ReadFile函数读取了<code>args_c.txt</code>文件如果不存在此文件则跳转，暂不清楚此文件的作用可能是后期存储收集到的信息</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/LdorcwPOhPPk8rUXunUxM0rQ2Hpeqr8M/66.jpg"></p>
<p>函数main_ZPBgbOEQ读取了<code>C:\ProgramData\Microsoft OneDrive\setup\rev.sav</code>文件，此文件可能也是用来存储一些收集到的数据</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/sBRSWryMQRj714EcfBdkBtXFbDMOE0IT/67.jpg"></p>
<p>接下来main_DNKvpcvy函数实现了加解密和收发网络请求，首先格式化了一个IP地址，此地址可能是C2服务器IP地址</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/L4pqILIpGdcz5lhvUNWocEyfWiWhB5Cy/68.jpg"></p>
<p>向C2<code>hxxps://www[.]fernandestechnical[.]com/pub/health_check[.]php</code>发送Get请求判断C2是否存活</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/2AEyxmu1Ub2CLQgoenGAPQksMqw47VtD/69.jpg"></p>
<p>向C2发送Get请求</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/q4WA95sm4JvLP42aFG7nFUHTReB7S0aH/93.jpg"></p>
<p>C2返回状态码200则C2存活</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/cC7XX0Fzhi4ESMvLwJTzB7YtTy8n4kKb/70.jpg"></p>
<p>C2和本机的keep-alive心跳包</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/BRrrbgOO5rd46neu3enzXWLn4st3l5Dp/94.jpg"></p>
<p>获取了本地IP地址</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/SSO37MAeQRstOMkx8HaJEvOSdqiJqmKb/71.jpg"></p>
<p>接下来使用RSA-2048加密了0x98大小的内容，其中包含了收集到的本机基本信息</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/gDrrSbObyDGalkQMYoHKVmmd8CxnHqhf/72.jpg"></p>
<p>RSA公钥为硬编码</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/GfUojlusOMyhkMDxOAvzXge15wPeEnLp/73.jpg"></p>
<p>RSA加密后的Buff为0x100</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/IpS7gyz1W3m2wqqPluXDMSb8mu5Vcp2l/74.jpg"></p>
<p>然后拼接了0x14C大小的缓冲区</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/OBwtse1XCFucVJnVbBgw63SuNeyFOkMg/75.jpg"></p>
<p>接下来使用了AesCBC模式加密，使用补全码0x4填充了4字节到0x150大小</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/cd43O6cIIsBrPUN6GzERczbD0g7UtfUa/76.jpg"></p>
<p>使用了硬编码的32字节Aes密钥进行加密</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/KAKocQJ2BXMY1N3aXK5dmmYiCJ6OLbMJ/77.jpg"></p>
<p>使用硬编码的AesCBC密钥加密后数据</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/9WeEqU9RReY90XHhjxq5nnMQBSTkRBLJ/78.jpg"></p>
<p>将随机生成的0x10大小的数据写入AesCBC加密后的缓冲区头部</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/hmBz1DxTdSh8YMBy9bhJ1Ol4brXBBHcB/79.jpg"></p>
<p>再次拼接将8563写入缓冲区头部</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/6XhKYEVUr1tCsoGMaiRUeHwNCTj4LvjI/80.jpg"></p>
<p>函数main_P6EwC8SB是对auth_post、data_post、addr_post、port_post字段数据进行加密的函数，此AesCBC模式加密密钥是随机生成的32字节</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/n2DWJm1OIMQ8HlGmmx2WUoc4IGP9lqG6/81.jpg"></p>
<p>使用AesCBC模式加密后</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/qcQlQE6mGGBEzjh5YhLxH9K6KrmJJGat/82.jpg"></p>
<p>接着生成了70个字节的随机数</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/5hpQdxPxl8n6cEiGwfu8omTaxfsMOxTS/83.jpg"></p>
<p>使用Base64对AesCBC模式加密后的数据进行编码</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/C02zFUffO95zgrbcm37svo5nBHUiFTK0/84.jpg"></p>
<p>将随机生成的70个字节数据填充到头部，将AesCBC模式加密使用的32字节大小随机生成密钥存放在70个字节数据之后，后面的为Base64编码后的加密数据</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/DeVnFvU8hCIJFfILV3acJ4d3LlUmpEVW/85.jpg"></p>
<p>函数main_GNd3j2oz就是生成session_key字段的数据，首先调用了go-smbios包获取bios硬件信息，并使用MD5哈希</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/3Eprv3xAFjfEkmwdpU1RaPSeDxsch7Ik/86.jpg"></p>
<p>将MD5转为十六进制</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/sXXjNLeLLBGiDnXaGmXCzLal9kKAbiOj/87.jpg"></p>
<p>之后将0x40字节大小的全局变量和bios信息MD5值和字符串windows进行格式化，随后直接使用Base64对这些数据进行了编码</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/GzLnquP58soXSWVkIsacqD4a73mwwnSj/88.jpg"></p>
<p>拼接好要发送的POST请求</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/jqLvmyJYAR9YNhGQaKnD4Yt7YbzYBCOU/89.jpg"></p>
<p>发送POST请求到C2</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/29QUQpKqYGC4euulTBgGXMqa58JAWe8H/90.jpg"></p>
<p>屏幕截取功能使用了screenshot开源库实现</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/ksVfAeoa10C8IF779JO4Adzw3y9WTYl2/91.jpg"></p>
<p>屏幕截图功能</p>
<p><img src="https://lc-gluttony.s3.amazonaws.com/ItdnDM9zGiJj/yETTA2Hj33Qej4V4pjrYuC296il4UoxA/92.jpg"></p>
<p>这里我使用了golang编写了解密脚本，除了session_key这个数据单单使用了Base64编码，其他的4个字段的数据都可以使用这个脚本解密，auth_post和data_post使用了3层加密，第一层的数据使用了RSA-2048进行加密，第二层req使用了硬编码的AesCBC密钥加密，第三层8563使用了随机生成的AesCBC加密，所以我们最多可以解密两层go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;crypto/aes&quot;</span></span><br><span class="line">    <span class="string">&quot;crypto/cipher&quot;</span></span><br><span class="line">    <span class="string">&quot;encoding/base64&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// addr_post字段加密数据</span></span><br><span class="line">    allcryptDataBase64 := <span class="string">&quot;EcgOPkkOHFylaFoLaqoXmbKPGOzvddbJMlnTtEtlScAdeewEFwzdITJsRYdYEushByrcQJCtuqdlGSeQyCjNieJBeQSnVwNcDhtQrh06LdGa3uyRHexahEL05goQ==&quot;</span></span><br><span class="line">    <span class="comment">// 加密数据前70个字节为垃圾数据，垃圾数据后的32个字节为AesCBC加密密钥</span></span><br><span class="line">    aesCBCKey := allcryptDataBase64[<span class="number">70</span> : <span class="number">70</span>+<span class="number">32</span>]</span><br><span class="line">    <span class="comment">// 需要解密的数据为70垃圾字节+32字节的AesCBC密钥后面的Base64编码数据</span></span><br><span class="line">    cryptDataBase64 := allcryptDataBase64[<span class="number">70</span>+<span class="number">32</span>:]</span><br><span class="line">    <span class="comment">// 将加密数据进行Base64解码</span></span><br><span class="line">    cryptData, _ := base64.StdEncoding.DecodeString(<span class="type">string</span>(cryptDataBase64))</span><br><span class="line">    <span class="comment">// 使用AesCBC解密数据</span></span><br><span class="line">    decryptData := AesDecryptCBC(cryptData, []<span class="type">byte</span>(aesCBCKey))</span><br><span class="line">    <span class="comment">// 打印解密数据</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%x\n&quot;</span>, decryptData)</span><br><span class="line">    <span class="comment">// 解密第二层数据：解密auth_post和data_post数据时再调用</span></span><br><span class="line">    DecryptoSecData(decryptData)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DecryptoSecData</span><span class="params">(decryptData []<span class="type">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 解密第二层加密</span></span><br><span class="line">    <span class="comment">// 硬编码AesCBCKey</span></span><br><span class="line">    gaesCBCKeyBase64 := <span class="string">&quot;F+h/WB8d+NYSnWX9UM6z3WxOHCIwd819TFldpsPfkrI=&quot;</span></span><br><span class="line">    <span class="comment">// 解码第二层硬编码的AesCBC密钥</span></span><br><span class="line">    gaesCBCKey, _ := base64.StdEncoding.DecodeString(<span class="type">string</span>(gaesCBCKeyBase64))</span><br><span class="line">    <span class="comment">// 第二层要解密的数据</span></span><br><span class="line">    secCryptData := decryptData[<span class="number">8</span>:]</span><br><span class="line">    <span class="comment">// 使用AesCBC解密数据</span></span><br><span class="line">    secDecryptData := AesDecryptCBC(secCryptData, []<span class="type">byte</span>(gaesCBCKey))</span><br><span class="line">    fmt.Println(<span class="string">&quot;第二层数据解密--------------------------------------&quot;</span>)</span><br><span class="line">    <span class="comment">// 打印解密数据</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%x&quot;</span>, secDecryptData)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AesCBC模式解密函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AesDecryptCBC</span><span class="params">(encrypted []<span class="type">byte</span>, key []<span class="type">byte</span>)</span></span> (decrypted []<span class="type">byte</span>) &#123;</span><br><span class="line">    <span class="comment">// 分组密钥</span></span><br><span class="line">    block, _ := aes.NewCipher(key)</span><br><span class="line">    <span class="comment">// 获取密钥块的长度</span></span><br><span class="line">    blockSize := block.BlockSize()</span><br><span class="line">    <span class="comment">// 加密模式</span></span><br><span class="line">    blockMode := cipher.NewCBCDecrypter(block, key[:blockSize])</span><br><span class="line">    <span class="comment">// 创建数组</span></span><br><span class="line">    decrypted = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(encrypted))</span><br><span class="line">    <span class="comment">// 解密</span></span><br><span class="line">    blockMode.CryptBlocks(decrypted, encrypted)</span><br><span class="line">    <span class="comment">// 去除补全码</span></span><br><span class="line">    decrypted = PKCS5UnPadding(decrypted)</span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除补全码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PKCS5UnPadding</span><span class="params">(origData []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">    length := <span class="built_in">len</span>(origData)</span><br><span class="line">    unpadding := <span class="type">int</span>(origData[length<span class="number">-1</span>])</span><br><span class="line">    <span class="keyword">return</span> origData[:(length - unpadding)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>NerbianRAT使用了现在主要的恶意软件传播方式之一为通过邮件附件的带VBA宏脚本的word文档进行传播，甚至不乏很多境外APT组织也使用此方式针对性攻击，go这种跨平台的编译型编程语言正被越来越多的恶意软件开发者采用，go众多的开源包可以实现快速开发，NerbianRAT使用了众多的反逆向和反虚拟机功能加大了分析的时间和难度，并且使用了RSA和AES组合的加密手段用来传输数据，对于此类传播方式的恶意软件能做的只有加强邮件地址过滤和附件检测和加大信息安全教育普及。</p>
<hr />
    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>yauv
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://yauv.me/nerbian-rat-sample-analysis-report.html" title="NerbianRat样本分析报告">https://yauv.me/nerbian-rat-sample-analysis-report.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/NerbianRat/" rel="tag"># NerbianRat</a>
              <a href="/tags/golang/" rel="tag"># golang</a>
              <a href="/tags/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" rel="tag"># 逆向工程</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
            </div>
            <div class="post-nav-item">
                <a href="/brute-ratel-c4-redteam-tools-analysis.html" rel="next" title="Brute Ratel C4红队框架和EDR的猫鼠游戏">
                  Brute Ratel C4红队框架和EDR的猫鼠游戏 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yauv</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
